<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <title>CLAUDE.md Public API ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: monospace; margin: 20px; max-width: 1200px; }
        .result { padding: 8px; margin: 3px 0; border-radius: 3px; }
        .pass { background: #d4edda; color: #155724; }
        .fail { background: #f8d7da; color: #721c24; }
        .info { background: #e2e3e5; color: #383d41; }
        button { padding: 10px 20px; margin: 5px; background: #007cba; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #005a87; }
        .json-display { background: #f8f9fa; padding: 15px; border-left: 3px solid #007cba; white-space: pre-wrap; font-family: monospace; font-size: 12px; max-height: 400px; overflow-y: auto; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>ğŸš€ CLAUDE.md Public API ãƒ†ã‚¹ãƒˆ</h1>
    <p>CLAUDE.mdã«è¨˜è¼‰ã•ã‚ŒãŸPublic function for JS/TSã®æ–°è¦å®Ÿè£…APIã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</p>
    
    <button onclick="testPublicAPIs()">ğŸ§ª Public API ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
    <button onclick="testRouteValidation()">ğŸ“ çµŒè·¯ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ ãƒ†ã‚¹ãƒˆ</button>
    <button onclick="testTerminalOperations()">ğŸš‰ ã‚¿ãƒ¼ãƒŸãƒŠãƒ«æ“ä½œ ãƒ†ã‚¹ãƒˆ</button>
    <button onclick="clearResults()">ğŸ§¹ çµæœã‚¯ãƒªã‚¢</button>
    
    <div id="status" style="padding: 10px; margin: 10px 0; border-radius: 5px; background: #e2e3e5;">
        WebAssemblyãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿ä¸­...
    </div>
    
    <div id="results"></div>

    <script>
        let FarertModule = null;
        let moduleReady = false;
        
        // ãƒ­ã‚°é–¢æ•°
        function log(message, status = 'info') {
            const div = document.createElement('div');
            div.className = 'result ' + status;
            div.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            document.getElementById('results').appendChild(div);
            console.log(message);
        }
        
        // JSONè¡¨ç¤ºé–¢æ•°
        function displayJson(title, jsonString) {
            const titleDiv = document.createElement('div');
            titleDiv.className = 'result pass';
            titleDiv.textContent = `${new Date().toLocaleTimeString()} - ${title}`;
            document.getElementById('results').appendChild(titleDiv);
            
            const jsonDiv = document.createElement('div');
            jsonDiv.className = 'json-display';
            jsonDiv.textContent = jsonString;
            document.getElementById('results').appendChild(jsonDiv);
        }
        
        // WebAssemblyãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿
        async function loadModule() {
            try {
                document.getElementById('status').textContent = 'WebAssemblyãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã¿ä¸­...';
                document.getElementById('status').style.background = '#fff3cd';
                
                const module = await import('./dist/farert.js');
                FarertModule = await module.default();
                moduleReady = true;
                
                document.getElementById('status').textContent = 'âœ… WebAssemblyãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿å®Œäº†ï¼Public APIæº–å‚™OK';
                document.getElementById('status').style.background = '#d4edda';
                
            } catch (error) {
                document.getElementById('status').textContent = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                document.getElementById('status').style.background = '#f8d7da';
            }
        }
        
        // Public API ãƒ†ã‚¹ãƒˆ
        async function testPublicAPIs() {
            if (!moduleReady) return;
            
            log('ğŸš€ CLAUDE.md Public API ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            
            try {
                // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š
                const dbResult = FarertModule.openDatabase();
                log(`openDatabase(): ${dbResult ? 'æˆåŠŸ' : 'å¤±æ•—'}`, dbResult ? 'pass' : 'fail');
                
                // åŸºæœ¬çš„ãªé§…ãƒ»è·¯ç·šæƒ…å ±å–å¾—
                const tokyoId = FarertModule.getStationId('æ±äº¬');
                const tokyoName = FarertModule.getStationName(tokyoId);
                log(`getStationId('æ±äº¬'): ${tokyoId}`, tokyoId > 0 ? 'pass' : 'fail');
                log(`getStationName(${tokyoId}): ${tokyoName}`, 'info');
                
                // æ–°è¦è¿½åŠ é–¢æ•°ã®ãƒ†ã‚¹ãƒˆ
                
                // 1. terminalName
                const terminalName = FarertModule.terminalName(tokyoId);
                log(`terminalName(${tokyoId}): "${terminalName}"`, 'pass');
                
                // 2. isJunction
                const junction = FarertModule.isJunction(tokyoId);
                log(`isJunction(${tokyoId}): ${junction ? 'ã¯ã„' : 'ã„ã„ãˆ'}`, 'pass');
                
                // 3. isSpecificJunction  
                const lineIds = JSON.parse(FarertModule.getLineIdsFromStation(tokyoId));
                if (lineIds.length > 0) {
                    const specificJunction = FarertModule.isSpecificJunction(lineIds[0], tokyoId);
                    log(`isSpecificJunction(${lineIds[0]}, ${tokyoId}): ${specificJunction ? 'ã¯ã„' : 'ã„ã„ãˆ'}`, 'pass');
                }
                
                // 4. ã‚¿ãƒ¼ãƒŸãƒŠãƒ«å±¥æ­´ãƒ†ã‚¹ãƒˆ
                FarertModule.saveToTerminalHistory('æ±äº¬,æ–°å®¿,å¤§é˜ª');
                const history = FarertModule.readFromTerminalHistory();
                log(`saveToTerminalHistory & readFromTerminalHistory: "${history}"`, 'pass');
                
                log('âœ… Public API ãƒ†ã‚¹ãƒˆå®Œäº†', 'pass');
                
            } catch (error) {
                log(`âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'fail');
            }
        }
        
        // çµŒè·¯ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ ãƒ†ã‚¹ãƒˆ
        async function testRouteValidation() {
            if (!moduleReady) return;
            
            log('ğŸ“ çµŒè·¯ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            
            try {
                FarertModule.openDatabase();
                
                // çµŒè·¯ä½œæˆ
                FarertModule.createRoute();
                log('createRoute(): çµŒè·¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆå®Œäº†', 'pass');
                
                // setupRoute ãƒ†ã‚¹ãƒˆï¼ˆæ–°è¦è¿½åŠ é–¢æ•°ï¼‰
                const setupResult = FarertModule.setupRoute('æ±äº¬,æ–°å®¿,å¤§é˜ª');
                log(`setupRoute('æ±äº¬,æ–°å®¿,å¤§é˜ª'): ${setupResult ? 'æˆåŠŸ' : 'å¤±æ•—'}`, setupResult ? 'pass' : 'fail');
                
                // routeScript ãƒ†ã‚¹ãƒˆï¼ˆæ–°è¦è¿½åŠ é–¢æ•°ï¼‰
                const script = FarertModule.routeScript();
                log(`routeScript(): "${script}"`, 'pass');
                displayJson('ğŸ“„ Route Script', script);
                
                // æ‰‹å‹•ã§é§…è¿½åŠ ã—ã¦ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ¯”è¼ƒ
                FarertModule.createRoute();
                const tokyoId = FarertModule.getStationId('æ±äº¬');
                const shinjukuId = FarertModule.getStationId('æ–°å®¿');
                FarertModule.addStation(tokyoId);
                FarertModule.addStation(shinjukuId);
                
                const manualScript = FarertModule.routeScript();
                log('æ‰‹å‹•çµŒè·¯ä½œæˆå¾Œã®routeScript():', 'info');
                displayJson('ğŸ“„ Manual Route Script', manualScript);
                
                log('âœ… çµŒè·¯ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ ãƒ†ã‚¹ãƒˆå®Œäº†', 'pass');
                
            } catch (error) {
                log(`âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'fail');
            }
        }
        
        // ã‚¿ãƒ¼ãƒŸãƒŠãƒ«æ“ä½œ ãƒ†ã‚¹ãƒˆ
        async function testTerminalOperations() {
            if (!moduleReady) return;
            
            log('ğŸš‰ ã‚¿ãƒ¼ãƒŸãƒŠãƒ«æ“ä½œ ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            
            try {
                FarertModule.openDatabase();
                
                // ä¸»è¦é§…ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«æƒ…å ±ã‚’å–å¾—
                const stations = ['æ±äº¬', 'æ–°å®¿', 'å¤§é˜ª', 'äº¬éƒ½', 'åå¤å±‹'];
                
                for (const stationName of stations) {
                    const stationId = FarertModule.getStationId(stationName);
                    if (stationId > 0) {
                        const terminalName = FarertModule.terminalName(stationId);
                        const isJunc = FarertModule.isJunction(stationId);
                        
                        log(`${stationName}é§… (ID:${stationId})`, 'info');
                        log(`  ã‚¿ãƒ¼ãƒŸãƒŠãƒ«å: "${terminalName}"`, 'pass');
                        log(`  ã‚¸ãƒ£ãƒ³ã‚¯ã‚·ãƒ§ãƒ³: ${isJunc ? 'ã¯ã„' : 'ã„ã„ãˆ'}`, 'pass');
                        
                        // æ¥ç¶šè·¯ç·šã‚’å–å¾—ã—ã¦specific junctionåˆ¤å®š
                        const lineIds = JSON.parse(FarertModule.getLineIdsFromStation(stationId));
                        log(`  æ¥ç¶šè·¯ç·šæ•°: ${lineIds.length}`, 'info');
                        
                        if (lineIds.length > 0) {
                            const lineName = FarertModule.getLineName(lineIds[0]);
                            const isSpecific = FarertModule.isSpecificJunction(lineIds[0], stationId);
                            log(`  è·¯ç·š"${lineName}"ã§ã®ç‰¹å®šã‚¸ãƒ£ãƒ³ã‚¯ã‚·ãƒ§ãƒ³: ${isSpecific ? 'ã¯ã„' : 'ã„ã„ãˆ'}`, 'pass');
                        }
                        
                        log('', ''); // ç©ºè¡Œ
                    }
                }
                
                log('âœ… ã‚¿ãƒ¼ãƒŸãƒŠãƒ«æ“ä½œ ãƒ†ã‚¹ãƒˆå®Œäº†', 'pass');
                
            } catch (error) {
                log(`âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'fail');
            }
        }
        
        // çµæœã‚¯ãƒªã‚¢
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
        window.addEventListener('load', loadModule);
    </script>
</body>
</html>